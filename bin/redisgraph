set -x
set -e

namespace=scox
release=redisgraph
image_repository=redislabs/redisgraph
image_tag=2.2.4

# https://github.com/bitnami/charts/tree/master/bitnami/redis
init () {
    helm repo add bitnami https://charts.bitnami.com/bitnami
}
start () {
    helm install $release \
	 --set image.repository=$image_repository \
	 --set image.tag=$image_tag \
	 --set master.command= \
	 --set slave.command= \
	 --namespace=$namespace \
	 bitnami/redis
}
start () {
    helm install $release \
	 --set image.repository=$image_repository \
	 --set image.tag=$image_tag \
	 --namespace=$namespace \
	 bitnami/redis
}
stop () {
    helm delete $release \
	 --namespace=$namespace
}
restart () {
    stop
    start
}
status () {
    kubectl --namespace=$namespace get pods | grep $release
    export REDIS_PASSWORD=$(kubectl get secret --namespace $namespace redisgraph -o jsonpath="{.data.redis-password}" | base64 --decode)
}
client () {
    #kubectl port-forward --namespace $namespace svc/redisgraph-master 6380:6379 &
    redis-cli -h 127.0.0.1 -p 6380 -a $REDIS_PASSWORD
}

bulk_load () {
    for file in data/bulk/nodes/*.csv; do
        echo $file
	redisgraph-bulk-loader test -n $file --separator \|
    done
    for file in data/bulk/edges/*.csv; do
        echo $file
	redisgraph-bulk-loader test -r $file --separator \|
    done
}

$*

exit 0
